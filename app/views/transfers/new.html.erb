<div class="container">
  <div class="form-container mt-5 mb-5">
  <%= form_tag transfers_path, id: "transfer-form" do %>
      <% label_tag :to %>
    <div class="form-cellule mt-5">
      <%= text_field_tag :to, nil, placeholder: "Address", class: "form-button-input" %>
    </div>

    <div class="form-cellule mt-5">
      <% label_tag :amount %>
      <%= text_field_tag :amount, nil, placeholder: "Amont", class: "form-button-input" %>
    </div>

    <%= hidden_field_tag :from, nil, id: "from-input" %>

    <div>
      <%= submit_tag "Send", class: "grey-button" %>
    </div>
  <% end %>

  <!-- Load Web3.js -->
  <script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>

  <script>
    window.addEventListener("load", async () => {
    // Connect to Ethereum network
    if (window.ethereum) {
      window.web3 = new Web3(ethereum);
      try {
        // Request account access
        await ethereum.enable();
      } catch (error) {
        console.error("User denied account access");
      }
    }
    // Legacy dapp browsers...
    else if (window.web3) {
      window.web3 = new Web3(web3.currentProvider);
    }
    // Non-dapp browsers...
    else {
      console.error("Non-Ethereum browser detected. You should consider trying MetaMask!");
    }

    // Get the first account from the Ethereum network
    const accounts = await web3.eth.getAccounts();
    const from = accounts[0];

    // Get the balance of the first account in Ether
    const balance = await web3.eth.getBalance(from);
    const balanceInEther = web3.utils.fromWei(balance, 'ether');

    // Handle form submission
    const form = document.getElementById("transfer-form");

    const fromContainer = document.getElementById("from");
    fromContainer.innerHTML = `Address ${from}`;

    // Display balance account
    const balanceContainer = document.getElementById("balance");
    balanceContainer.innerHTML = `Balance: ${balanceInEther} ETH`;

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

    // Get form values
    const to = form.elements.to.value;
    const amount = form.elements.amount.value;

    // Convert the amount to wei (the smallest unit of ether)
    const amountInWei = web3.utils.toWei(amount, "ether");

    // Send the transaction
    try {
      const result = await web3.eth.sendTransaction({ from, to, value: amountInWei });
      console.log(result);

      transactionsTable.appendChild(row);
    } catch (error) {
      console.error(error);
    }
  });
  });
  </script>

  <!-- app/views/transactions/index.html.erb -->
    <div class="container">
      <div id="balance"></div>
      <div id="from"></div>
    </div>
  </div>
</div>
