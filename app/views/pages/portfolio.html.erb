<% @portfolio_value = 0 %>
<% @number_of_crypto = 0 %>

<!-- get pourcentage allocation -->
<% @wallets.each do |wallet| %>
    <!-- get number of crypto -->
    <% @number_of_crypto += wallet.cryptos.size %>
    <% wallet.cryptos.each do |crypto| %>
        <% @search_cryptos.each do |search_crypto| %>
            <% if crypto.name == search_crypto["name"] %>
                <% @crypto_current_price = search_crypto["current_price"] %>
            <% end %>
        <% end %>
        <!-- get portfolio value -->
        <% @value = crypto.number * @crypto_current_price %>
        <% @portfolio_value += @value%>
    <% end %>
<% end %>

<h1 class="m-2">ASSETS ALLOCATION (<%= @number_of_crypto %>)</h1>


<!-- print crypto name / current_value / allocation / wallet name / number of cryptos / value -->
<div class="container-portfolio">

    <% @wallets.each do |wallet| %>
            <% wallet.cryptos.each do |crypto| %>
                <div class="card-portfolio">
                  <div class="card-portfolio-box">
                      <p><%= crypto.name %></p>
                  </div>
                  <!-- get current_price / symbol -->
                  <% @search_cryptos.each do |search_crypto| %>
                      <% if crypto.name == search_crypto["name"] %>
                          <% @crypto_current_price = search_crypto["current_price"] %>
                          <% @crypto_symbol = search_crypto["symbol"] %>
                      <% end %>
                  <% end %>
                  <div class="card-portfolio-box">
                      <p> € <%= @crypto_current_price %></p>
                  </div>
                  <div class="card-portfolio-box">
                      <% @value = crypto.number * @crypto_current_price %>
                  </div>
                  <div class="card-portfolio-box">
                      <p><%= @crypto_poucentage_allocation =
                            ((@value * 100) / @portfolio_value).round(2) %> %</p>
                  </div>
                  <div class="card-portfolio-box">
                      <p><%= wallet.name %></p>
                  </div>
                  <div class="card-portfolio-box">
                      <p><%= crypto.number %> <%= @crypto_symbol.upcase %></p>
                  </div>
                  <div class="card-portfolio-box">
                      <p>€ <%= @value = (crypto.number * @crypto_current_price ).round(2) %></p>
                  </div>
            </div>
            <% end %>
    <% end %>
</div>

<!-- print portfolio value -->
<div class="m-2">
    <p>Total: € <%= @portfolio_value.round(2)  %></p>
</div>
